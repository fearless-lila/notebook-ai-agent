                  ┌────────────────────────┐
                  │      START SYSTEM       │
                  └────────────┬───────────┘
                               │
                               ▼
            ┌───────────────────────────────────────┐
            │ Load existing embeddings from ChromaDB │
            └───────────────────────────────────────┘
                               │
                               ▼
         ┌────────────────────────────────────────────┐
         │ (Optional) Load notes.json into NOTES_DB    │
         │  → Only for API-created notes               │
         └────────────────────────────────────────────┘
                               │
                               │
                               ▼
                 ┌──────────────────────┐
                 │   USER INTERACTION   │
                 └─────────┬────────────┘
                           │
       ┌───────────────────┴───────────────────────────────┐
       │                                                   │
       ▼                                                   ▼
┌──────────────────────────────┐              ┌──────────────────────────────┐
│ A) File-Based Notes           │              │ B) Notes Created via API      │
└─────────────┬────────────────┘              └─────────────┬────────────────┘
              │                                              │
              ▼                                              ▼
  ┌─────────────────────────┐                     ┌─────────────────────────────┐
  │ Run ingest_notes.py     │                     │ POST /notes endpoint        │
  └────────┬────────────────┘                     └──────────────┬──────────────┘
           │                                                     │
           ▼                                                     ▼
  ┌────────────────────────────────────────────────┐   ┌───────────────────────────────────────┐
  │ Read all .md/.txt files under notes/           │   │ Receive note title + content from UI │
  └────────────────────────────────────────────────┘   └───────────────────────────────────────┘
           │                                                     │
           ▼                                                     ▼
  ┌────────────────────────────────────────────────┐   ┌────────────────────────────────────────┐
  │ For each note: Clean → Embed using OpenAI      │   │ Embed note content using OpenAI        │
  └────────────────────────────────────────────────┘   └────────────────────────────────────────┘
           │                                                     │
           ▼                                                     ▼
  ┌────────────────────────────────────────────────┐   ┌────────────────────────────────────────┐
  │ Store (text + embedding + metadata) in Chroma  │   │ Store (text + embedding + metadata)    │
  └────────────────────────────────────────────────┘   │ in Chroma                               │
                                                        └────────────────────────────────────────┘
                                                           │
                                                           ▼
                                          ┌────────────────────────────────────────┐
                                          │ Save note metadata into notes.json     │
                                          │ (for permanent /notes listing)         │
                                          └────────────────────────────────────────┘

                          ┌──────────────────────────────────────┐
                          │ USER ASKS A QUESTION → POST /chat   │
                          └─────────────────┬────────────────────┘
                                            │
                                            ▼
         ┌────────────────────────────────────────────────────────────────┐
         │ 1. Embed user question using OpenAI                            │
         └────────────────────────────────────────────────────────────────┘
                                            │
                                            ▼
         ┌────────────────────────────────────────────────────────────────┐
         │ 2. Query Chroma for top-k most similar note embeddings         │
         └────────────────────────────────────────────────────────────────┘
                                            │
                                            ▼
         ┌────────────────────────────────────────────────────────────────┐
         │ 3. Retrieve the text of those notes (context chunks)           │
         └────────────────────────────────────────────────────────────────┘
                                            │
                                            ▼
         ┌────────────────────────────────────────────────────────────────┐
         │ 4. Build a prompt: System prompt + Context + User question     │
         └────────────────────────────────────────────────────────────────┘
                                            │
                                            ▼
         ┌────────────────────────────────────────────────────────────────┐
         │ 5. Call ChatGPT (OpenAI)                                       │
         └────────────────────────────────────────────────────────────────┘
                                            │
                                            ▼
         ┌────────────────────────────────────────────────────────────────┐
         │ 6. Model answers *only* using retrieved notes                   │
         └────────────────────────────────────────────────────────────────┘
                                            │
                                            ▼
                       ┌────────────────────────────────────────────┐
                       │ Return answer + contexts back to the user  │
                       └────────────────────────────────────────────┘